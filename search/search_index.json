{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Hosty","text":"<p>Multi-tenant static hosting platform written in C.</p>"},{"location":"#docs","title":"Docs","text":"<ul> <li>System Design</li> </ul>"},{"location":"design/","title":"Hosty \u2014 Detailed Design Document","text":""},{"location":"design/#table-of-contents","title":"Table of Contents","text":"<ul> <li>Overview</li> <li>Goals and Non-Goals</li> <li>Architecture</li> <li>HTTP Server Design</li> <li>Database Design</li> <li>Security Considerations</li> </ul>"},{"location":"design/#1-overview","title":"1. Overview","text":"<p>Hosty is a multi-tenant static website hosting platform written entirely in C, designed to allow multiple users to host static websites (HTML/CSS/JS) for free while also providing a lightweight backend API backed by a custom-built persistent database.</p> <p>The project is intentionally low-level and infrastructure-focused. Instead of building an application (like an e-commerce site), Hosty builds the underlying systems: an HTTP server, a multi-tenant routing layer, a secure static file server, an authenticated API, and a durable storage engine.</p> <p>This document specifies the full system architecture, components, data flow, storage format, concurrency model, and security considerations.</p>"},{"location":"design/#high-level-architecture","title":"High-Level Architecture","text":""},{"location":"design/#2-goals-and-non-goals","title":"2. Goals and Non-Goals","text":""},{"location":"design/#21-goals","title":"2.1 Goals","text":"<ul> <li>Provide static website hosting for multiple tenants</li> <li>Support virtual hosting via subdomains (Host header)</li> <li>Expose a simple HTTP API usable by static frontend JavaScript</li> <li>Implement a custom persistent database (no external DB)</li> <li>Ensure tenant isolation and basic abuse protection</li> <li>Run as a single deployable service on a Linux VM</li> </ul>"},{"location":"design/#22-non-goals","title":"2.2 Non-Goals","text":"<ul> <li>No server-side scripting (PHP, Python, Node)</li> <li>No SQL, joins, or complex queries</li> <li>No arbitrary user code execution</li> <li>No payment, billing, or user UI dashboards</li> <li>No high-availability or multi-node replication</li> </ul>"},{"location":"design/#3-high-level-architecture","title":"3. High-Level Architecture","text":""},{"location":"design/#31-system-stack","title":"3.1 System Stack","text":"<pre><code>Browser (HTML/CSS/JS)\n        \u2193 HTTPS\nNginx (TLS termination, reverse proxy)\n        \u2193 HTTP (localhost)\nCustom C HTTP Server\n  \u251c\u2500 Virtual Host Resolver\n  \u251c\u2500 Request Router\n  \u251c\u2500 Static File Server\n  \u251c\u2500 API Layer\n  \u251c\u2500 Auth / Quotas / Rate Limiter\n  \u2514\u2500 Thread Pool\n        \u2193\nCustom Key-Value Database (WAL + In-memory Index)\n</code></pre>"},{"location":"design/#32-deployment-model","title":"3.2 Deployment Model","text":"<ul> <li>Single Linux VM (Oracle/AWS/GCP free tier)</li> <li>Nginx listens on ports 80/443</li> <li>Hosty listens on 127.0.0.1:8080</li> <li>Hosty runs as non-root via systemd</li> </ul>"},{"location":"design/#4-http-server-design","title":"4. HTTP Server Design","text":""},{"location":"design/#41-networking-layer","title":"4.1 Networking Layer","text":"<ul> <li>Uses POSIX sockets</li> <li>TCP, IPv4</li> <li><code>SO_REUSEADDR</code> enabled</li> <li>Configurable listen port</li> <li>Timeouts for read/write operations</li> </ul>"},{"location":"design/#42-connection-handling","title":"4.2 Connection Handling","text":"<ul> <li>One accept loop</li> <li>Accepted sockets are placed into a work queue</li> <li>Worker threads pull sockets and fully handle requests</li> </ul>"},{"location":"design/#43-thread-pool","title":"4.3 Thread Pool","text":"<ul> <li>Fixed-size pool (e.g. 4\u20138 threads)</li> <li>Shared queue protected by mutex + condition variable</li> <li>Prevents unbounded thread creation</li> </ul>"},{"location":"design/#5-http-parsing","title":"5. HTTP Parsing","text":""},{"location":"design/#51-supported-methods","title":"5.1 Supported Methods","text":"<ul> <li>GET</li> <li>PUT</li> <li>DELETE</li> </ul>"},{"location":"design/#52-parsing-rules","title":"5.2 Parsing Rules","text":"<ul> <li>Read until <code>\\r\\n\\r\\n</code> (end of headers)</li> <li>Enforce maximum header size (e.g. 16 KB)</li> <li> <p>Parse request line:</p> </li> <li> <p>method</p> </li> <li>path</li> <li>HTTP version</li> </ul>"},{"location":"design/#53-header-handling","title":"5.3 Header Handling","text":"<ul> <li>Required: <code>Host</code></li> <li>Optional: <code>Content-Length</code>, <code>Connection</code>, <code>X-API-Key</code></li> <li>Unknown headers ignored</li> </ul> <p>Malformed requests return 400 Bad Request.</p>"},{"location":"design/#6-virtual-hosting-multi-tenancy","title":"6. Virtual Hosting (Multi-Tenancy)","text":""},{"location":"design/#61-tenant-resolution","title":"6.1 Tenant Resolution","text":"<ul> <li>Extract hostname from <code>Host</code> header</li> <li>Strip port if present</li> <li>Match <code>*.yourdomain.com</code></li> <li>Leftmost label = tenant name</li> </ul> <p>Example:</p> <pre><code>Host: alice.yourdomain.com \u2192 tenant = alice\n</code></pre>"},{"location":"design/#62-validation","title":"6.2 Validation","text":"<ul> <li>Allowed tenant characters: <code>[a-z0-9-]{1,32}</code></li> <li>Invalid tenant \u2192 400</li> </ul>"},{"location":"design/#63-directory-mapping","title":"6.3 Directory Mapping","text":"<pre><code>/srv/sites/&lt;tenant&gt;/public/\n</code></pre>"},{"location":"design/#7-static-file-server","title":"7. Static File Server","text":""},{"location":"design/#71-file-resolution","title":"7.1 File Resolution","text":"<ul> <li><code>/</code> \u2192 <code>/index.html</code></li> <li>Paths resolved relative to tenant root</li> </ul>"},{"location":"design/#72-security","title":"7.2 Security","text":"<ul> <li>Reject <code>..</code> after URL decoding</li> <li>Never follow symlinks</li> <li>Enforce chroot-like behavior by path checks</li> </ul>"},{"location":"design/#73-response","title":"7.3 Response","text":"<ul> <li>Proper <code>Content-Type</code></li> <li>Correct <code>Content-Length</code></li> <li>Status codes: 200, 403, 404</li> </ul>"},{"location":"design/#8-api-layer","title":"8. API Layer","text":""},{"location":"design/#81-routing","title":"8.1 Routing","text":"<ul> <li>Paths beginning with <code>/api/</code> routed to API handler</li> </ul>"},{"location":"design/#82-endpoints","title":"8.2 Endpoints","text":"Method Path Description PUT /api/data/ Set value GET /api/data/ Get value DELETE /api/data/ Delete value"},{"location":"design/#83-key-rules","title":"8.3 Key Rules","text":"<ul> <li>Allowed key chars: <code>[A-Za-z0-9._-]{1,64}</code></li> <li>Max value size (e.g. 64 KB)</li> </ul>"},{"location":"design/#9-authentication-authorization","title":"9. Authentication &amp; Authorization","text":""},{"location":"design/#91-api-keys","title":"9.1 API Keys","text":"<ul> <li>Each tenant has an API key</li> <li>Passed via <code>X-API-Key</code> header</li> <li>Stored hashed (SHA-256)</li> </ul>"},{"location":"design/#92-authorization","title":"9.2 Authorization","text":"<ul> <li>Tenant determined by Host header</li> <li>API key must match tenant</li> <li>No cross-tenant access possible</li> </ul>"},{"location":"design/#10-rate-limiting-quotas","title":"10. Rate Limiting &amp; Quotas","text":""},{"location":"design/#101-rate-limiting","title":"10.1 Rate Limiting","text":"<ul> <li>Token bucket per tenant</li> <li>Limits API request rate</li> </ul>"},{"location":"design/#102-storage-quotas","title":"10.2 Storage Quotas","text":"<ul> <li>Max bytes per tenant</li> <li>Enforced during writes</li> </ul>"},{"location":"design/#11-custom-database-design","title":"11. Custom Database Design","text":""},{"location":"design/#111-overview","title":"11.1 Overview","text":"<ul> <li>Single-node embedded KV store</li> <li>Append-only write-ahead log (WAL)</li> <li>In-memory hash table index</li> </ul>"},{"location":"design/#112-record-format","title":"11.2 Record Format","text":"<p>Each record contains:</p> <ul> <li>magic number</li> <li>version</li> <li>flags (SET / DEL)</li> <li>tenant length</li> <li>key length</li> <li>value length</li> <li>tenant bytes</li> <li>key bytes</li> <li>value bytes</li> <li>CRC32 checksum</li> </ul>"},{"location":"design/#113-operations","title":"11.3 Operations","text":"<ul> <li>SET: append record + update index</li> <li>GET: lookup index + read WAL offset</li> <li>DEL: append tombstone</li> </ul>"},{"location":"design/#114-recovery","title":"11.4 Recovery","text":"<ul> <li>On startup, replay WAL sequentially</li> <li>Verify CRC</li> <li>Rebuild index</li> </ul>"},{"location":"design/#115-concurrency","title":"11.5 Concurrency","text":"<ul> <li>Global read-write lock</li> <li>GET = read lock</li> <li>PUT/DEL = write lock</li> </ul>"},{"location":"design/#12-logging-metrics","title":"12. Logging &amp; Metrics","text":""},{"location":"design/#121-access-logs","title":"12.1 Access Logs","text":"<ul> <li>Timestamp</li> <li>Tenant</li> <li>Method</li> <li>Path</li> <li>Status</li> <li>Latency</li> </ul>"},{"location":"design/#122-metrics-endpoint","title":"12.2 Metrics Endpoint","text":"<ul> <li><code>/metrics</code></li> <li>Requests total</li> <li>API requests</li> <li>Error counts</li> <li>Average latency</li> </ul>"},{"location":"design/#13-error-handling-strategy","title":"13. Error Handling Strategy","text":"<ul> <li>Fail fast on malformed input</li> <li>Never crash on user input</li> <li>Graceful shutdown on SIGINT</li> <li>Always fsync WAL before ACK</li> </ul>"},{"location":"design/#14-security-considerations","title":"14. Security Considerations","text":"<ul> <li>Run as non-root</li> <li>Input validation everywhere</li> <li>No dynamic code execution</li> <li>No file uploads via HTTP</li> <li>Nginx handles TLS</li> </ul>"},{"location":"design/#15-future-enhancements-optional","title":"15. Future Enhancements (Optional)","text":"<ul> <li>WAL compaction</li> <li>Keep-alive connections</li> <li>HTTP range requests</li> <li>Directory auto-index</li> <li>Git-based deployments</li> </ul>"},{"location":"design/#16-summary","title":"16. Summary","text":"<p>Hosty demonstrates low-level systems engineering by building a complete hosting stack from scratch in C: networking, HTTP, multi-tenancy, security, persistence, and deployment. It is intentionally scoped to be small, safe, and educational while remaining realistic and production-inspired.</p>"}]}